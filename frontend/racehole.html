<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css" type="text/css">
    <link rel="icon" href="assets/icon.png" type="image/png">
    <title>Racehole</title>
</head>
<body>
    <div class="body">
        <div id="money">
            <div id="moneyValue">
                <div id="mon"></div>
                <div id="val"></div>
            </div>
        </div>
        <div id="screen">
            <canvas id="myCanvas" width="1296" height="728" style="border: 1px solid black;"></canvas>
        </div>
        <div id="settings">
            <div class="settingsButton" id="back"></div>
            <div class="settingsButton" id="zoomIn"></div>
            <div class="settingsButton" id="zoomOut"></div>
            <div class="settingsButton" id="music"></div>
            <div class="settingsButton" id="volume"></div>
        </div>
    </div>

    <script>
        var backDiv = document.getElementById("back");
        backDiv.onclick = function() {
            window.location.href = '/city';
        };
        var zoomInButton = document.getElementById("zoomIn");
        zoomInButton.onclick = function() {
            document.body.style.zoom = parseFloat(window.getComputedStyle(document.body).zoom) + 0.1;
        };
        var zoomOutButton = document.getElementById("zoomOut");
        zoomOutButton.onclick = function() {
            document.body.style.zoom = parseFloat(window.getComputedStyle(document.body).zoom) - 0.1;
        };
    </script>
	<script>
        // Pobierz element Canvas
		let speed=10 //poruszanie na boki
		let life=3   //życie
		let agresive=20 // im mniejsza wartość tym baba częściej coś robi (min k20)
		let stopAnimation=false;
        const canvas = document.getElementById("myCanvas");
        const ctx = canvas.getContext("2d");
		let ud=1;
        const animationFrames = [
            "assets/race/babathrow1.png",
            "assets/race/babathrow2.png",
            "assets/race/babathrow3.png",
            "assets/race/babathrow5.png",
            "assets/race/babathrow4.png",
            "assets/race/babathrow6.png",
            "assets/race/babathrow7.png",
            "assets/race/babathrow8.png",
			"assets/race/babolot.gif"
        ]; // Tutaj przechowamy klatki animacji

        const spriteWidth = 200; // Szerokość pojedynczej klatki animacji w pikselach (zmień na odpowiednią wartość)
        const spriteHeight = 100; // Wysokość pojedynczej klatki animacji w pikselach (zmień na odpowiednią wartość)

        const numFrames = 8; // Całkowita liczba klatek animacji (zmień na odpowiednią wartość)

        // Grafiki
        const backgroundImage = new Image();
        backgroundImage.src = "assets/race/street.png";

        const playerImage = new Image();
        playerImage.src = "assets/race/Ourcar.png";

        const randomImage = new Image();
        randomImage.src = animationFrames[0];
		let currentFrameIndex=0;
		
        const coneImage = new Image();
        coneImage.src = "assets/race/cone.png";
		
		let babolotImage = new Image();
		babolotImage.src = "assets/race/babolot.gif";
		let babaX=200;
		let babaY=100;
		
var screenDiv=document.getElementById("screen")		


    var imageElement = document.createElement("img");
    imageElement.src = "assets/race/scenenoloop.gif";
    imageElement.width = 1296;
    imageElement.height = 728
	
	

		
        // Wymiary i położenie kwadratu gracza
        const squareSize = 100;
        const cornSize = 50;
		
        let playerX = canvas.width / 2 - squareSize / 2;
        const playerY = 600;

        // Wymiary i położenie kwadratu losowego
        let randomSquareX = canvas.width / 2 - squareSize / 2;
        let randomSquareY = 20; // Kwadrat będzie na górze ekranu

        // Zmienna do określania kierunku ruchu kwadratu losowego (-1 dla lewo, 1 dla prawo)
        let randomSquareDirection = Math.random() < 0.5 ? -1 : 1;

        // Tablica przechowująca obiekty spadające
        const fallingObjects = [];

        // Zmienna do liczenia wylosowanych liczb 5
        let countOfFives = 0;

        // Zmienna do przechowywania aktualnego y pozycji tła
        let backgroundY = 0;

        // Szybkość przewijania tła
        const backgroundSpeed = 5;

        // Punkty
        let points = 0;
		

let moves=false;
function animate()
{
return moves=true;
}


        // Funkcja do aktualizacji ruchu kwadratu losowego
        function updateRandomSquare() {
            // Rzuć kostką K100
		    setTimeout(() => {
        animate();
    }, 1000);			
			if(moves==true)
			{
			
            currentFrameIndex+=1;
			if(currentFrameIndex==2)
			{
			currentFrameIndex=0;
			}
			moves=false
			}
			
if(stopAnimation==false)
{			
            randomImage.src = animationFrames[currentFrameIndex];

            const rollResult = Math.floor(Math.random() * agresive) + 1;

            // Jeśli wypadnie 1, zmień kierunek ruchu
            if (rollResult === 1) {
                randomSquareDirection *= -1;
            }


            // Ogranicz ruch kwadratu losowego do 350px w lewo/prawo od centrum ekranu			
            if (
                randomSquareX + squareSize / 2 + 5 * randomSquareDirection <= canvas.width / 2 + 200 &&
                randomSquareX + squareSize / 2 + 5 * randomSquareDirection >= canvas.width / 2 - 200 - squareSize
            ) {
                randomSquareX += 5 * randomSquareDirection;
				
            }
			else{
			randomSquareDirection*=-1;
			}

            // Sprawdź, czy wylosowano liczbę 5
            if (rollResult === 5) {
                countOfFives++;
            }

            // Wyświetl kwadrat spadający w dół po wylosowaniu 5
            if (countOfFives > 0) {
                // Dodaj nowy obiekt spadający do tablicy
                fallingObjects.push({
                    x: randomSquareX,
                    y: randomSquareY,
                });
                // Zresetuj licznik wylosowanych piątek
                countOfFives = 0;
            }
}
else
{
randomSquareY=randomSquareY-5*ud;

if(randomSquareY<-95)
{
 randomImage.src = babolotImage.src;
ud*=-1;
babaX/=2
babaY/=2
randomSquareX=playerX;
}
if(randomSquareY==playerY-100)
{
var imageElement=document.createElement("img")
imageElement.src=("assets/race/scenenoloop.gif")
imageElement.width=1296
imageElement.height=728

canvas.remove();
screenDiv.appendChild(imageElement);
}



}
            // Aktualizuj pozycję wszystkich obiektów spadających
            for (const fallingObject of fallingObjects) {
                fallingObject.y += 10;

                // Sprawdź kolizję z graczem
                if (
                    fallingObject.y + cornSize >= playerY &&
                    fallingObject.y <= playerY + cornSize &&
                    fallingObject.x + squareSize >= playerX &&
                    fallingObject.x <= playerX + squareSize
                ) {
				if(life==1)
				{
                    alert("BOOM!");
                    resetGame();
					return;
				}
				else
				{
				alert(life)
				fallingObjects.splice(fallingObjects.indexOf(fallingObject), 1);
				life--;
				}
                    
                }

                // Sprawdź, czy spadający obiekt wypadł poza ekran
                if (fallingObject.y > canvas.height) {
                    // Jeśli tak, dodaj punkt i usuń go z tablicy
                    points++;
                    fallingObjects.splice(fallingObjects.indexOf(fallingObject), 1);
                }
            }

            // Przesuń tło w dół
            backgroundY += backgroundSpeed;
            if (backgroundY >= canvas.height) {
                backgroundY = 0;
            }

            // Wyczyść Canvas i narysuj tło
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.drawImage(backgroundImage, 0, backgroundY, canvas.width, canvas.height);
            ctx.drawImage(backgroundImage, 0, backgroundY - canvas.height, canvas.width, canvas.height);

            // Narysuj gracza i obrazy spadające na nowych pozycjach
            ctx.drawImage(randomImage, randomSquareX, randomSquareY - 25, babaX, babaY);
            ctx.drawImage(playerImage, playerX, playerY, squareSize, squareSize);

            // Narysuj wszystkie obiekty spadające
            for (const fallingObject of fallingObjects) {
                ctx.drawImage(coneImage, fallingObject.x + 60, fallingObject.y, cornSize, cornSize);
            }

            // Wyświetl punkty na ekranie
            ctx.fillStyle = "black";
            ctx.font = "20px Arial";
            ctx.fillText("Punkty: " + points, 20, 30);

            // Wywołaj funkcję ponownie przy następnej animacji
			
            requestAnimationFrame(updateRandomSquare);
			
			
        }

        // Funkcja resetująca grę
        function resetGame() {
		fallingObjects.length = 0;
		stopAnimation=true;
		clearCanvas();
		updateRandomSquare();
		
            //location.reload();
        }
		
				        function clearCanvas() {
            // Wyczyść Canvas i narysuj tło
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.drawImage(backgroundImage, 0, backgroundY, canvas.width, canvas.height);
            ctx.drawImage(backgroundImage, 0, backgroundY - canvas.height, canvas.width, canvas.height);

            // Narysuj gracza i animację "babathrow" na nowych pozycjach
            if (stopAnimation == true) {
                ctx.drawImage(randomImage, randomSquareX, randomSquareY - 25, babaX,babaY);
            }
            ctx.drawImage(playerImage, playerX, playerY, squareSize, squareSize);
        }
		
		

        // Obsługa naciśnięcia klawiszy strzałek dla gracza
        window.addEventListener("keydown", (event) => {
		
		if(stopAnimation==false)
		{
            switch (event.key) {
                case "ArrowLeft":
                    if (playerX - speed >= canvas.width / 2 - 200 - squareSize) {
                        playerX -= speed;
                    }
                    break;
                case "ArrowRight":
                    if (playerX + speed + squareSize <= canvas.width / 2 + 250) {
                        playerX += speed;
                    }
                    break;
                case "ArrowUp":
                    if (playerY - 10 >= 0) {
                        playerY -= 10;
                    }
                    break;
                case "ArrowDown":
                    if (playerY + 10 + squareSize <= canvas.height) {
                        playerY += 10;
                    }
                    break;
            }
		
            // Wyczyść Canvas i narysuj tło
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.drawImage(backgroundImage, 0, backgroundY, canvas.width, canvas.height);
            ctx.drawImage(backgroundImage, 0, backgroundY - canvas.height, canvas.width, canvas.height);

            // Narysuj gracza i obrazy spadające na nowych pozycjach
            ctx.drawImage(randomImage, randomSquareX, randomSquareY, squareSize, squareSize);
            ctx.drawImage(playerImage, playerX, playerY, squareSize, squareSize);

            // Narysuj wszystkie obiekty spadające
			}

		
            for (const fallingObject of fallingObjects) {
                ctx.drawImage(coneImage, fallingObject.x, fallingObject.y, cornSize, cornSize);
            }
			
        });

		
        // Wywołaj funkcję aktualizującą ruch kwadratu losowego
        requestAnimationFrame(updateRandomSquare);
		
	
		
		
		
        // Narysuj początkowe położenie obu obrazów
        ctx.drawImage(backgroundImage, 0, backgroundY, canvas.width, canvas.height);
        ctx.drawImage(backgroundImage, 0, backgroundY - canvas.height, canvas.width, canvas.height);
        ctx.drawImage(playerImage, playerX, playerY, squareSize, squareSize);
        ctx.drawImage(randomImage, randomSquareX, randomSquareY, squareSize, squareSize);
screenDiv.onload=function()
{
alert("kebab")

}

		

		
    </script>
</body>
</html>